<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OneMarket News ‚Äî Writer Dashboard</title>
  <meta name="description" content="Contributor hub for OneMarket News: submit stories, track status, and review guidelines." />
  <meta name="theme-color" content="#000" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --lime:#a3e635; color-scheme: dark; }
    body { background:#000; color:#fff }
    .noise { background-image: radial-gradient(1px 1px at 25px 25px,rgba(255,255,255,.9)1px,transparent 0); opacity:.06 }
    .glass { background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.04)); backdrop-filter:blur(10px) saturate(120%) }
    @keyframes fadeIn { from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:translateY(0)} }
    .fade-in { animation: fadeIn .6s ease-out .1s both }

    /* Premium inputs */
    .field{
      width:100%;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      padding:.875rem 1rem;
      color:#fff;
      font-size:.95rem;
      line-height:1.25rem;
      transition:background .2s,border-color .2s,box-shadow .2s,transform .06s;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.05), 0 0 0 0 rgba(163,230,53,.35);
      outline:none;
    }
    .field::placeholder{ color:rgba(255,255,255,.48); letter-spacing:.15px; }
    .field:hover{ background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.22); }
    .field:focus{
      background:rgba(255,255,255,.10); border-color:rgba(255,255,255,.35);
      box-shadow:0 0 0 8px rgba(163,230,53,.08), 0 0 0 2px rgba(163,230,53,.35), inset 0 1px 0 rgba(255,255,255,.06);
      transform:translateY(-1px);
    }
    textarea.field{ min-height:3.5rem; resize:vertical; scrollbar-width:thin; scrollbar-color:rgba(255,255,255,.35) transparent; }

    /* Dark-friendly native selects */
    select.field{
      appearance:none; padding-right:2.25rem;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23cbd5e1" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5"/></svg>');
      background-repeat:no-repeat; background-position:right .9rem center; background-size:16px 16px;
    }
    option{ background:#0b0b0b; color:#fff; }

    /* Sidebar active state */
    .nav-item[aria-current="page"]{
      background: rgba(163,230,53,.12);
      border-color: rgba(163,230,53,.45);
      color: #fff;
    }

    /* Buttons */
    .btn{border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.07); border-radius:9999px; padding:.55rem .9rem; font-size:.9rem}
    .btn:hover{background:rgba(255,255,255,.12)}
    .btn-primary{background:var(--lime); color:#000; border-color:transparent}
    .btn-primary:hover{background:#c3f36a}
  </style>
</head>
<body class="min-h-screen">
  <!-- Background -->
  <div class="fixed inset-0 -z-10">
    <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/25 to-black/80"></div>
    <div aria-hidden class="noise absolute inset-0 pointer-events-none"></div>
  </div>

  <!-- Global header (consistent across app) -->
  <header class="sticky top-0 z-40 backdrop-blur bg-black/40 border-b border-white/10">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
      <a href="/" class="font-black tracking-tight">
        ONE<span class="text-lime-400">MARKET</span> <span class="font-semibold text-white/80">News</span>
      </a>
      <nav class="text-sm text-white/70 flex items-center gap-4">
        <a class="hover:text-white" href="./feed.html">Feed</a>
        <a class="hover:text-white" href="./admin.html">Admin</a>
        <a class="hover:text-white" href="./editor.html">Editor</a>
        <a class="hover:text-white" href="./dashboard.html">Dashboard</a>
        <a class="hover:text-white inline-flex items-center gap-1" href="./settings.html">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 8.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Zm9 3.5c0-.5-.04-.98-.12-1.45l2.02-1.57-1.9-3.29-2.4.84a8.9 8.9 0 0 0-2.5-1.45l-.38-2.54H9.28l-.38 2.54a8.9 8.9 0 0 0-2.5 1.45l-2.4-.84-1.9 3.29L4.12 10C4.04 10.47 4 10.95 4 11.45c0 .5.04.98.12 1.45l-2.02 1.57 1.9 3.29 2.4-.84a8.9 8.9 0 0 0 2.5 1.45l.38 2.54h3.44l.38-2.54a8.9 8.9 0 0 0 2.5-1.45l2.4.84 1.9-3.29-2.02-1.57c.08-.47.12-.95.12-1.45Z"/></svg>
          Settings
        </a>
      </nav>
    </div>
  </header>

  <!-- Shell -->
  <div class="mx-auto flex max-w-7xl flex-col md:flex-row">

    <!-- Sidebar -->
    <aside class="glass md:sticky md:top-[56px] md:h-[calc(100vh-56px)] w-full md:w-64 border-b md:border-b-0 md:border-r border-white/10">
      <div class="flex items-center justify-between px-4 py-4 md:py-6">
        <a href="./feed.html" class="text-white/80 hover:text-white text-sm inline-flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M10 19a1 1 0 0 1-.7-.29l-7-7a1 1 0 0 1 0-1.42l7-7A1 1 0 0 1 11 4v4h8a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-8v4a1 1 0 0 1-1 1z"/></svg>
          Back to Feed
        </a>
        <button id="menuBtn" class="md:hidden rounded-lg border border-white/15 px-2 py-1 text-sm text-white/80 hover:text-white">Menu</button>
      </div>

      <div id="nav" class="px-3 pb-4 md:block hidden">
        <nav class="space-y-2">
          <button class="nav-item w-full rounded-xl border border-white/10 px-3 py-2 text-left text-white/80 hover:text-white hover:border-white/25" data-target="home">üè† Dashboard</button>
          <button class="nav-item w-full rounded-xl border border-white/10 px-3 py-2 text-left text-white/80 hover:text-white hover:border-white/25" data-target="submit">üìù Submit Story</button>
          <button class="nav-item w-full rounded-xl border border-white/10 px-3 py-2 text-left text-white/80 hover:text-white hover:border-white/25" data-target="submissions">üìÇ My Submissions</button>
          <button class="nav-item w-full rounded-xl border border-white/10 px-3 py-2 text-left text-white/80 hover:text-white hover:border-white/25" data-target="guidelines">üìö Guidelines</button>
        </nav>

        <div class="mt-6 rounded-xl border border-white/10 bg-white/5 p-3 text-xs text-white/70">
          Logged in as <span class="font-semibold">Contributor</span>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 p-4 md:p-8 space-y-6">

      <!-- Header -->
      <header class="fade-in">
        <span class="inline-flex items-center gap-2 rounded-full border border-white/15 bg-white/5 px-3 py-1 text-xs tracking-wider">
          <span class="h-2 w-2 rounded-full bg-lime-400"></span> Writer Dashboard
        </span>
        <h1 class="mt-3 text-4xl font-black">ONE<span class="text-lime-400">MARKET</span> <span class="font-semibold text-white/80">News</span></h1>
        <p class="text-white/70 mt-2">Submit stories, track review status, and follow sourcing standards ‚Äî all in one place.</p>
      </header>

      <!-- Sections -->
      <section id="home" class="fade-in space-y-4" data-section>
        <div class="grid gap-4 md:grid-cols-3">
          <div class="glass rounded-2xl p-5">
            <p class="text-white/60 text-sm">Stories Submitted</p>
            <p id="statSubmitted" class="mt-1 text-3xl font-bold">0</p>
          </div>
          <div class="glass rounded-2xl p-5">
            <p class="text-white/60 text-sm">In Review</p>
            <p id="statReview" class="mt-1 text-3xl font-bold">0</p>
          </div>
          <div class="glass rounded-2xl p-5">
            <p class="text-white/60 text-sm">Published</p>
            <p id="statPublished" class="mt-1 text-3xl font-bold">0</p>
          </div>
        </div>

        <div class="glass rounded-2xl p-6">
          <h2 class="text-lg font-semibold">Welcome</h2>
          <p class="mt-2 text-white/80 text-sm">Thanks for contributing to the trust-layer of news. Use <span class="font-medium">Submit Story</span> to send items to editors. You‚Äôll see everything you submit in <span class="font-medium">My Submissions</span>.</p>
        </div>
      </section>

      <section id="submit" class="fade-in hidden" data-section>
        <div class="glass rounded-2xl p-6">
          <h2 class="text-lg font-semibold">Submit a Story</h2>
          <p class="text-white/70 text-sm mt-1">Provide a clear title, links to sources, and a short summary. Editors will review and follow up if needed.</p>

          <form id="storyForm" action="https://formspree.io/f/YOUR_FORM_ID" method="POST" class="mt-5 space-y-5">
            <div>
              <label for="title" class="mb-1 block text-sm text-white/70">Title</label>
              <input id="title" name="title" required class="field" placeholder="Concise story headline" />
            </div>

            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label for="primary_url" class="mb-1 block text-sm text-white/70">Primary Source URL</label>
                <input id="primary_url" name="primary_url" type="url" required class="field" placeholder="https://..." />
              </div>
              <div>
                <label for="secondary_urls" class="mb-1 block text-sm text-white/70">Secondary URLs (optional)</label>
                <input id="secondary_urls" name="secondary_urls" class="field" placeholder="Comma-separated links" />
              </div>
            </div>

            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label for="beat" class="mb-1 block text-sm text-white/70">Beat / Category</label>
                <select id="beat" name="beat" class="field">
                  <option>AI</option>
                  <option>Chips / Hardware</option>
                  <option>Energy</option>
                  <option>Markets</option>
                  <option>Policy / Regulation</option>
                  <option>Other</option>
                </select>
              </div>
              <div>
                <label for="tags" class="mb-1 block text-sm text-white/70">Tags (comma-separated)</label>
                <input id="tags" name="tags" class="field" placeholder="e.g., openai, nvidia, earnings" />
              </div>
            </div>

            <div>
              <label for="summary" class="mb-1 block text-sm text-white/70">Summary (2‚Äì4 sentences)</label>
              <textarea id="summary" name="summary" rows="4" class="field" placeholder="Key facts in your own words + what matters and why."></textarea>
            </div>

            <div class="flex items-center gap-3">
              <button type="submit" class="inline-flex items-center gap-2 rounded-full bg-lime-400 px-6 py-3 font-semibold text-black shadow-lg shadow-lime-500/20 transition hover:-translate-y-0.5 hover:bg-lime-300 focus:outline-none focus:ring-2 focus:ring-lime-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M5 12h14M12 5v14"/></svg>
                Submit Story
              </button>
              <span id="storyMsg" class="text-sm text-white/70"></span>
            </div>
          </form>
        </div>
      </section>

      <section id="submissions" class="fade-in hidden" data-section>
        <div class="glass rounded-2xl p-6">
          <div class="flex items-center justify-between gap-3">
            <h2 class="text-lg font-semibold">My Submissions</h2>
            <div class="text-xs text-white/60">Autosaves locally for preview. Final decisions come from editors.</div>
          </div>

          <div class="mt-4 overflow-x-auto">
            <table class="min-w-full text-sm">
              <thead>
                <tr class="text-left text-white/60">
                  <th class="py-2 pr-4">Title</th>
                  <th class="py-2 pr-4">Beat</th>
                  <th class="py-2 pr-4">Date</th>
                  <th class="py-2 pr-4">Status</th>
                  <th class="py-2 pr-4">Primary URL</th>
                </tr>
              </thead>
              <tbody id="subsTbody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="guidelines" class="fade-in hidden" data-section>
        <div class="glass rounded-2xl p-6 space-y-4">
          <h2 class="text-lg font-semibold">Sourcing & Citation Standards</h2>
          <ul class="list-disc pl-5 text-sm text-white/80 space-y-2">
            <li>Link every claim to a high-quality source. Prefer primary docs, filings, official blog posts, or transcripts.</li>
            <li>Summarize in your own words. Quote sparingly and attribute clearly.</li>
            <li>Add a <strong>Why it matters</strong> line for context and impact.</li>
            <li>If a correction is needed, submit an update ‚Äî corrections are celebrated.</li>
            <li>Disclose conflicts of interest (holdings, employment, paid relationships) in your submission.</li>
          </ul>

          <h3 class="mt-4 font-semibold">Story Format</h3>
          <ol class="list-decimal pl-5 text-sm text-white/80 space-y-2">
            <li><strong>Headline:</strong> concise and factual.</li>
            <li><strong>Summary:</strong> 2‚Äì4 sentences with the key facts.</li>
            <li><strong>Sources:</strong> 1+ primary, 1‚Äì2 secondary for context.</li>
            <li><strong>Tags:</strong> 2‚Äì5 keywords (company, topic, person).</li>
          </ol>
        </div>
      </section>

      <footer class="pt-2 pb-8 text-center text-xs text-white/60">
        ¬© <span id="year"></span> OneMarket News, LLC.
      </footer>
    </main>
  </div>

  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Mobile menu toggle (sidebar)
    const menuBtn = document.getElementById('menuBtn');
    const nav = document.getElementById('nav');
    if (menuBtn) menuBtn.addEventListener('click', () => nav.classList.toggle('hidden'));

    // Section switching + hash routing
    const sections = Array.from(document.querySelectorAll('[data-section]'));
    const buttons = Array.from(document.querySelectorAll('.nav-item'));
    function showSection(id){
      sections.forEach(s => s.classList.toggle('hidden', s.id !== id));
      buttons.forEach(b => b.setAttribute('aria-current', b.dataset.target === id ? 'page' : 'false'));
      history.replaceState(null, '', '#' + id);
    }
    buttons.forEach(b => b.addEventListener('click', () => showSection(b.dataset.target)));
    const init = location.hash?.slice(1) || 'home';
    (buttons.find(b => b.dataset.target === init) || buttons[0]).click();

    // Local storage helpers for mock table
    const KEY = 'onemarket.submissions';
    const readSubs = () => { try { return JSON.parse(localStorage.getItem(KEY) || '[]'); } catch { return []; } };
    const writeSubs = (rows) => localStorage.setItem(KEY, JSON.stringify(rows));
    const tbody = document.getElementById('subsTbody');
    const statSubmitted = document.getElementById('statSubmitted');
    const statReview = document.getElementById('statReview');
    const statPublished = document.getElementById('statPublished');

    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function escapeAttr(s){ return (s||'').replace(/"/g, '&quot;'); }

    function renderSubs(){
      const rows = readSubs();
      tbody.innerHTML = '';
      rows.forEach(r => {
        const tr = document.createElement('tr');
        tr.className = 'border-t border-white/10';
        tr.innerHTML = `
          <td class="py-2 pr-4">${escapeHtml(r.title||'')}</td>
          <td class="py-2 pr-4 text-white/70">${escapeHtml(r.beat||'')}</td>
          <td class="py-2 pr-4 text-white/70">${r.date ? new Date(r.date).toLocaleDateString() : ''}</td>
          <td class="py-2 pr-4"><span class="rounded-full bg-white/10 px-2 py-1 text-xs">${escapeHtml(r.status||'In Review')}</span></td>
          <td class="py-2 pr-4">${
            r.primary_url
              ? `<a class="underline decoration-lime-400/60 underline-offset-2 text-white/80 hover:text-white" href="${escapeAttr(r.primary_url)}" target="_blank" rel="noopener">Open</a>`
              : '<span class="text-white/40">‚Äî</span>'
          }</td>
        `;
        tbody.appendChild(tr);
      });
      statSubmitted.textContent = rows.length;
      statReview.textContent = rows.filter(r => r.status === 'In Review').length;
      statPublished.textContent = rows.filter(r => r.status === 'Published').length;
    }
    renderSubs();

    // Submit Story (Formspree + local preview)
    const storyForm = document.getElementById('storyForm');
    const storyMsg = document.getElementById('storyMsg');
    storyForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      storyMsg.textContent = 'Submitting‚Ä¶';
      const fd = new FormData(storyForm);

      // local preview row
      const row = {
        id: 'm_' + Math.random().toString(36).slice(2,10),
        title: fd.get('title'),
        beat: fd.get('beat'),
        tags: (fd.get('tags')||'').split(',').map(s=>s.trim()).filter(Boolean),
        date: Date.now(),
        status: 'In Review',
        primary_url: fd.get('primary_url'),
        summary: fd.get('summary') || '',
        citations: (fd.get('secondary_urls')||'').split(',').map(s=>s.trim()).filter(Boolean)
      };
      const rows = readSubs();
      rows.unshift(row);
      writeSubs(rows);
      renderSubs();

      // send to Formspree
      try {
        const res = await fetch(storyForm.action, { method:'POST', body:fd, headers:{'Accept':'application/json'} });
        if(res.ok){
          storyMsg.className = 'text-sm text-lime-300';
          storyMsg.textContent = 'Received! Editors will review shortly.';
          storyForm.reset();
        }else{
          storyMsg.className = 'text-sm text-red-300';
          storyMsg.textContent = 'Submission failed. Please try again.';
        }
      } catch {
        storyMsg.className = 'text-sm text-red-300';
        storyMsg.textContent = 'Network error. Saved locally ‚Äî try again later.';
      }
    });

    /* ‚úÖ Active navigation highlight (global) */
    (function highlightActiveNav() {
      const here = new URL(location.href);
      const normalize = (p) => p.replace(/\/$/, "/index.html");
      const current = normalize(here.pathname);
      document.querySelectorAll("header nav a[href]").forEach(a => {
        const dest = new URL(a.getAttribute("href"), here).pathname;
        if (normalize(dest) === current) {
          a.classList.add("text-lime-300","bg-white/5","rounded-lg","ring-2","ring-lime-300/40");
        }
      });
    })();
  </script>
</body>
</html>
